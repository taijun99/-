<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <title>순행</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/src/main/resources/static/index.js"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=LIBRARY"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services,clusterer,drawing"></script>

    <!--sidebar-->
    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/sidebars/">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="/css/style3.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>

    <!-- 사이드바 닫는 주석 -->

</head>

<style>
    @import "https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700";


    body {
        font-family: 'Poppins', sans-serif;
        background: #fafafa;
    }

    p {
        font-family: 'Poppins', sans-serif;
        font-size: 1.1em;
        font-weight: 300;
        line-height: 1.7em;
        color: #999;
    }

    a, a:hover, a:focus {
        color: inherit;
        text-decoration: none;
        transition: all 0.3s;
    }

    .navbar {
        padding: 15px 10px;
        background: #fff;
        border: none;
        border-radius: 0;
        margin-bottom: 40px;
        box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    }

    .navbar-btn {
        box-shadow: none;
        outline: none !important;
        border: none;
    }

    .line {
        width: 100%;
        height: 1px;
        border-bottom: 1px dashed #ddd;
        margin: 40px 0;
    }

    /* ---------------------------------------------------
        SIDEBAR STYLE
    ----------------------------------------------------- */
    #sidebar {
        width: 250px;
        position: fixed;
        top: 0;
        left: -250px;
        height: 100vh;
        z-index: 999;
        background: white;
        color: #fff;
        transition: all 0.3s;
        overflow-y: scroll;
        box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.2);
    }

    #sidebar.active {
        left: 0;
    }

    #dismiss {
        width: 35px;
        height: 35px;
        line-height: 35px;
        text-align: center;
        background: #7386D5;
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        -webkit-transition: all 0.3s;
        -o-transition: all 0.3s;
        transition: all 0.3s;
    }
    #dismiss:hover {
        background: #fff;
        color: #7386D5;
    }

    .overlay {
        position: fixed;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        z-index: 998;
        display: none;
    }

    #sidebar .sidebar-header {
        padding: 20px;
        background: white;
        color : black;
    }

    #sidebar ul.components {
        padding: 20px 0;
        border-bottom: 1px solid #1E90FF;
    }

    #sidebar ul p {
        color: #fff;
        padding: 10px;
    }

    #sidebar ul li a {
        padding: 10px;
        font-size: 1.1em;
        display: block;
    }
    #sidebar ul li a:hover {
        color: #7386D5;
        background: #fff;
    }

    #sidebar ul li.active > a, a[aria-expanded="true"] {
        color: #fff;
        background: #6d7fcc;
    }



</style>
<style>
    .wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
    .wrap * {padding: 0;margin: 0;}
    .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
    .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
    .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
    .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
    .info .close:hover {cursor: pointer;}
    .info .body {position: relative;overflow: hidden;}
    .info .desc {position: relative;margin: 13px 0 0 90px;height: 75px;}
    .desc .ellipsis {overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
    .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
    .info .img {position: absolute;top: 6px;left: 5px;width: 73px;height: 71px;border: 1px solid #ddd;color: #888;overflow: hidden;}
    .info:after {content: '';position: absolute;margin-left: -12px;left: 50%;bottom: 0;width: 22px;height: 12px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
    .info .link {color: #5085BB;}

</style>

<body class="p-0 m-0 border-0 bd-example bg-body-secondary">



<header>
    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div id="dismiss">
                <i class="fas fa-arrow-left"></i>
            </div>

            <div class="sidebar-header">
                <h3>순행</h3>
            </div>

            <ul class="list-unstyled components">
                <li class="active">


                <li class="nav-item">
                    <a href="/clubScnu/club" class="nav-link link-dark" aria-current="page">
                        <i class="bi bi-door-open"></i>
                        &nbsp동아리
                    </a>
                </li>
                <li>
                    <a href="/clubScnu/school" class="nav-link link-dark">
                        <i class="bi bi-door-open-fill"></i>
                        &nbsp학교 행사
                    </a>
                </li>
                <li>
                    <a href="/clubScnu/student" class="nav-link link-dark">
                        <i class="bi bi-door-closed-fill"></i>
                        &nbsp학생회 행사
                    </a>
                </li>
                <li>
                    <a href="/clubScnu/scholarship" class="nav-link link-dark">
                        <i class="bi bi-door-closed"></i>
                        &nbsp장학금
                    </a>
                </li>
                <li>
                    <a href="/clubScnu/extracurricular" class="nav-link link-dark">
                        <i class="bi bi-door-closed"></i>
                        &nbsp비교과
                    </a>
                </li>

                <li>
                    <a href="#" class="nav-link link-dark">
                        <i class="bi bi-calendar"></i>
                        &nbsp캘린더
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link link-dark">
                        <i class="bi bi-chat"></i>
                        &nbsp채팅
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link link-dark">
                        <svg class="bi me-2" width="16" height="16">
                            <use xlink:href="#people-circle" />
                        </svg>
                        내가쓴글
                    </a>
                </li>
                {{#userName}}
                    Logged in as: <span id="user">{{userName}}</span>
                    <a href="/logout" class="btn btn-info active" role="button">Logout</a>
                {{/userName}}
                {{^userName}}
                    <a href="/oauth2/authorization/google" class="btn btn-success active" role="button">Google Login</a>
                {{/userName}}
            </ul>



            <div class="dropdown">
                <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2"
                   data-bs-toggle="dropdown" aria-expanded="false">
                    <strong>앱정보</strong>
                </a>
                <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
                    <li><a class="dropdown-item" href="#">로그인</a></li>
                    <li><a class="dropdown-item" href="#">회원가입</a></li>
                    <li><a class="dropdown-item" href="#">내 정보</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="#">로그아웃</a></li>
                </ul>
            </div>
        </nav>

        <!-- Page Content  -->
        <div id="content">

            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">

                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-justify"></i>

                    </button>

                </div>
            </nav>
        </div>
    </div>

    <div class="overlay"></div>

    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#sidebar").mCustomScrollbar({
                theme: "minimal"
            });

            $('#dismiss, .overlay').on('click', function () {
                $('#sidebar').removeClass('active');
                $('.overlay').removeClass('active');
            });

            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').addClass('active');
                $('.overlay').addClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });
        });
    </script>

</header>


<main>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <div id="map" class="kakaomap" style="width: 100%; max-width:700px; height:500px;"></div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=64810ef38e28e2efe96520c8a962ec06"></script>
    <script>
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(34.968901, 127.479367), // 지도의 중심좌표
                    level: 4 // 지도의 확대 레벨
                };



        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

        var imageSrc = "/img/marker.png";

        var positions = [];
        fetch('/api/main/')
                .then(function(response) {
                    if (response.ok) {
                        return response.json(); // JSON 형식의 데이터를 받아올 때
                        // 또는 return response.text(); // 텍스트 데이터를 받아올 때
                    }
                    throw new Error('네트워크 상태가 좋지 않습니다.');
                })
                .then(function(data) {
                    // 데이터를 활용하여 작업을 수행
                    for(var i = 0;i<Object.keys(data).length;i++){
                        var content = {
                            title: data[i].title,
                            latlng: new kakao.maps.LatLng(data[i].latitude, data[i].longitude),
                            latituded: data[i].latitude,
                            imgsrc : data[i].filepath,
                            place : data[i].place,
                            info : data[i].info,
                            id : data[i].id,
                        }
                        positions.push(content);
                        console.log(positions)
                    };

                    for(var i=0;i<positions.length;i++){

                        var imageSize = new kakao.maps.Size(24, 35);

                        // 마커 이미지를 생성합니다
                        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

                        // 마커를 생성합니다
                        var marker = new kakao.maps.Marker({
                            map: map, // 마커를 표시할 지도
                            position: positions[i].latlng, // 마커를 표시할 위치
                            title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                            image : markerImage // 마커 이미지
                        });
                        var data = positions[i];
                        displayMarker(data);
                    }


                    function displayMarker(data){
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: data.latlng
                        })
                        console.log(data);
                        var overlay = new kakao.maps.CustomOverlay({
                            position: marker.getPosition()
                        });
                        var content = document.createElement('div');
                        content.setAttribute("class","wrap");

                        var info = document.createElement('div');
                        info.setAttribute("class","info");
                        content.appendChild(info);

                        var title = document.createElement('div');
                        title.setAttribute("class","title");
                        info.appendChild(title);
                        title.innerHTML = data.title ;

                        var close = document.createElement('btn');
                        close.setAttribute("class","btn btn-primary");
                        close.setAttribute("style","float:right");
                        close.innerHTML='닫기';
                        title.appendChild(close);

                        var body = document.createElement('div');
                        body.setAttribute("class","body");
                        info.appendChild(body);

                        var img = document.createElement('div');
                        body.appendChild(img);
                        img.setAttribute("class","img");

                        var imgsrg = document.createElement('img')
                        img.appendChild(imgsrg);
                        imgsrg.setAttribute("src",data.imgsrc);
                        imgsrg.setAttribute("style","position: absolute;top: 0px;left: 0px;width: 73px;height: 71px;border: 0px solid #ddd;color: #888;overflow: hidden;");


                        var desc = document.createElement('div');
                        body.appendChild(desc);
                        desc.setAttribute("class","desc");

                        var ellipsis = document.createElement('div');
                        desc.appendChild(ellipsis);
                        ellipsis.setAttribute("class","ellipsis");
                        ellipsis.innerHTML = data.info;

                        var jibun_ellipsis =document.createElement('div');
                        desc.appendChild(jibun_ellipsis);
                        jibun_ellipsis.setAttribute("class","jibun ellipsis");
                        jibun_ellipsis.innerHTML = data.place;


                        var sang = document.createElement('a');
                        desc.appendChild(sang);
                        sang.setAttribute("href","/scnu/" +data.latituded);
                        sang.setAttribute("class","link");
                        sang.innerHTML = "상세보기";




                        close.onclick = function () {
                            overlay.setMap(null);
                        }
                        overlay.setContent(content);

                        kakao.maps.event.addListener(marker, 'click', function() {
                            overlay.setMap(map);
                        });
                    }



                })



                .catch(function(error) {
                    console.log('오류가 발생했습니다.', error);
                });

    </script>

</main>
</body>
<style>
    .kakaomap{
        margin-top: 5%;
    }
    p{
        font-weight: 900;
        font-size: large;
    }
</style>
</html>